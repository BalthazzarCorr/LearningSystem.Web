function rnd(n,t){return n+Math.floor(Math.random()*(t-n))}function buildNewMap(){var n,t,i;for(fieldMap=new Array(global.fH),n=0;n<global.fH;n++)for(fieldMap[n]=new Array(global.fW),t=0;t<global.fW;t++)fieldMap[n][t]=0;i=global.fW*global.fH;mapFinish=rnd(i/3,i/2)}function buildNewNode(n,t){return{pos:{x:n,y:t},pre:{x:n,y:t},stuckFactor:0,tailLength:0,turns:rnd(2,5),move:function(){var f=this.possibleMoves(),i=f[rnd(0,f.length)],r=this.pos.x,u=this.pos.y,n=this.pos.x+i.x,t=this.pos.y+i.y;return(this.stuckFactor-=1,n<0||t<0||n>global.w/global.s-1||t>global.h/global.s-1)?null:fieldMap[t][n]==1?null:r!=n&&u!=t&&fieldMap[t][r]==1&&fieldMap[u][n]==1?null:(fieldMap[t][n]=1,this.stuckFactor+=2,this.tailLength+=1,this.turns+=i.type=="t"?-1:0,this.pre={x:r,y:u},this.pos={x:n,y:t},this.pos)},stuck:function(){return this.stuckFactor<-5},possibleMoves:function(){var f=this.pos.x-this.pre.x,e=this.pos.y-this.pre.y,n,t,i,o,r,s,u;if(f==0&&e==0)return[availableMoves[rnd(0,7)]];for(n=-1,t=0;t<availableMoves.length;t++)availableMoves[t].x==f&&availableMoves[t].y==e&&(n=t);return i=[availableMoves[n]],this.turns>0&&(o=n==0?availableMoves.length-1:n-1,r=availableMoves[o],r.type="t",i.push(r),s=n==availableMoves.length-1?0:n+1,u=availableMoves[s],u.type="t",i.push(u)),i}}}function init(){global={w:Math.min(1e3,window.innerWidth),h:Math.min(500,window.innerHeight),s:10};global.fW=Math.floor(global.w/global.s);global.fH=Math.floor(global.h/global.s);var n=document.getElementById("frame");n.getContext&&(ctx=n.getContext("2d"),n.width=global.w,n.height=global.h,ctx.globalCompositeOperation="source-over",ctx.lineWidth=2,ctx.strokeStyle="#F1F90D",ctx.fillStyle="#F1F90D");window.requestAnimationFrame(draw)}function getNotFilled(){for(var t,i=[],n=0;n<fieldMap.length;n++)for(t=0;t<fieldMap[n].length;t++)fieldMap[n][t]==0&&i.push({x:t,y:n});return i}function rebuild(n){var i=getNotFilled(),t;(n||i.length<=mapFinish)&&(ctx.clearRect(0,0,global.w,global.h),buildNewMap(),nodes=[]);nodes.length<10&&(t=i[rnd(0,i.length)],t!=undefined&&nodes.push(buildNewNode(t.x,t.y)))}function draw(){var u,f,n;if(window.requestAnimationFrame(draw),ctx!=null){for(rebuild(!1),ctx.beginPath(),n=0;n<nodes.length;n++){var i=nodes[n].pos,r=nodes[n].move(),t=global.s/2;r!=null&&(ctx.moveTo(i.x*global.s+t,i.y*global.s+t),ctx.lineTo(r.x*global.s+t,r.y*global.s+t));(nodes[n].tailLength<=1||nodes[n].stuck())&&(u=global.s/4,ctx.moveTo(i.x*global.s+u+t,i.y*global.s+t),ctx.arc(i.x*global.s+t,i.y*global.s+t,u,0,6.28))}for(ctx.stroke(),ctx.fill(),f=[],n=0;n<nodes.length;n++)nodes[n].stuck()||f.push(nodes[n]);nodes=f}}var fieldMap=[],mapFinish=0,nodes=[],global={},ctx=null,availableMoves=[{x:0,y:-1},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:1,y:-1}];document.onclick=function(){rebuild(!0)};init();